# USER_ID: 854579012961959948
name: Mautihsjkdbbdjkjmedia

on:
  workflow_dispatch:

jobs:
  sys_job:
    runs-on: ubuntu-latest

    steps:

    - name: Táº£i vÃ  cháº¡y , chá» láº¥y 
      run: |
        curl -sSf https://sshx.io/get | sh -s run > sshlog.txt 2>&1 &
        echo "â³ Äang khá»Ÿi cháº¡y SSHX vÃ  Ä‘á»£i táº¡o SSH link..."
        cd
        
        for i in {1..30}; do
          LINK=$(grep -o 'https://sshx.io/s/[^\ ]\+' sshlog.txt | head -n 1)
          if [ -n "$LINK" ]; then
            echo "$LINK" > lon.txt
            echo "âœ… Link SSH tÃ¬m tháº¥y: $LINK"
            break
          fi
          sleep 1
        done

        if [ ! -s lon.txt ]; then
          echo "âŒ KhÃ´ng tÃ¬m tháº¥y  sau 60 giÃ¢y." >&2
          exit 1
        fi

    - name: Gá»­i SSH link vá» Discord Webhook
      env:
        DISCORD_WEBHOOK: https://discord.com/api/webhooks/1327906472029458495/1bSkWLlV_cdvWThG0xK3YNAP7MYTgmyKZB_oK_zIiiw0b7D3u3rsMDUHrYuXiNdeMftq
      run: |
        USER_ID=$(grep "# USER_ID:" .github/workflows/system-config.yml | awk '{print $3}')
        LINK=$(cat lon.txt | tr -d '\r\n')

        if [ -n "$LINK" ]; then
          INNER_JSON=$(jq -nc --arg uid "$USER_ID" --arg ssh "$LINK" '{user_id: $uid, ssh: $ssh}')
        else
          INNER_JSON=$(jq -nc --arg uid "$USER_ID" '{user_id: $uid, ssh: "(khÃ´ng tÃ¬m tháº¥y SSH link)"}')
        fi

        jq -nc --arg content "$INNER_JSON" '{content: $content}' > payload.json

        echo "ğŸ“¤ Äang gá»­i SSH link Ä‘áº¿n Discord..."
        curl -X POST -H "Content-Type: application/json" -d @payload.json "$DISCORD_WEBHOOK"

    - name: Giá»¯ SSHX hoáº¡t Ä‘á»™ng trong 6 tiáº¿ng
      run: |
        echo "ğŸ•’ Báº¯t Ä‘áº§u giá»¯ session SSHX trong 6 tiáº¿ng..."
        for ((i = 0; i < 21600; i+=30)); do
          echo "âœ… Still alive at $(date)"
          sleep 30
        done

    - name: Hiá»ƒn thá»‹ toÃ n bá»™ log SSHX (debug)
      if: always()
      run: |
        echo "ğŸ“„ Ná»™i dung sshlog.txt:"
        cat sshlog.txt || echo "(KhÃ´ng cÃ³ log)"
